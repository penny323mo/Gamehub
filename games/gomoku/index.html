<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gomoku</title>
    <link rel="stylesheet" href="gomoku.css?v=cdb1150">
</head>

<body>
    <div class="switch-container gomoku-menu-container">
        <main class="switch-card">
            <h1>äº”å­æ£‹</h1>
            <div style="font-size: 0.7rem; color: #666; margin-top: -10px; margin-bottom: 20px;">
                Build: fixed-rooms-v1 2026-01-25 20:55
            </div>

            <!-- Landing Page / Game Selection -->
            <div id="landing-page">
                <div class="landing-actions">
                    <button id="gomoku-ai-btn" class="pill-btn mode-btn" data-action="ai" onclick="selectMode('ai')">å°
                        AI å°æˆ°</button>
                    <button id="gomoku-online-btn" class="pill-btn mode-btn" data-action="online"
                        onclick="selectMode('online')">ONLINE å°æˆ°</button>
                    <button id="gomoku-back-btn" class="pill-btn secondary" data-action="back"
                        onclick="goToLauncher()">è¿”å›éŠæˆ²å¤§å»³</button>
                </div>
            </div>

            <!-- Game Container (Hidden on Landing) -->
            <div id="game-container" class="hidden">

                <!-- VS AI Specific Controls -->
                <div id="ai-controls" class="hidden">
                    <div class="controls-card">
                        <label for="difficulty">é›£åº¦ï¼š</label>
                        <select id="difficulty" class="pill-select">
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard" selected>Hard</option>
                        </select>
                        <button class="pill-btn secondary" onclick="backToLanding()">è¿”å›é¸å–®</button>
                    </div>
                </div>

                <!-- Online Lobby: å›ºå®šä¸‰æˆ¿åˆ—è¡¨ -->
                <div id="online-lobby" class="hidden">
                    <h3>ç·šä¸Šå°æˆ°å¤§å»³</h3>
                    <p style="font-size:0.8rem; color:#888; margin-bottom:15px;">é¸æ“‡æˆ¿é–“åŠ å…¥å°æˆ°</p>

                    <div id="room-list" class="room-list">
                        <!-- Room Cards -->
                        <div class="room-card" id="room-card-ROOM01">
                            <div class="room-name">ğŸ  ROOM 01</div>
                            <div class="room-info">
                                <span class="room-status" id="room-status-ROOM01">è¼‰å…¥ä¸­...</span>
                                <span class="room-players" id="room-players-ROOM01">âš« - / âšª -</span>
                            </div>
                            <button class="pill-btn room-join-btn" id="room-join-ROOM01"
                                onclick="joinFixedRoom('ROOM01')">åŠ å…¥</button>
                        </div>

                        <div class="room-card" id="room-card-ROOM02">
                            <div class="room-name">ğŸ  ROOM 02</div>
                            <div class="room-info">
                                <span class="room-status" id="room-status-ROOM02">è¼‰å…¥ä¸­...</span>
                                <span class="room-players" id="room-players-ROOM02">âš« - / âšª -</span>
                            </div>
                            <button class="pill-btn room-join-btn" id="room-join-ROOM02"
                                onclick="joinFixedRoom('ROOM02')">åŠ å…¥</button>
                        </div>

                        <div class="room-card" id="room-card-ROOM03">
                            <div class="room-name">ğŸ  ROOM 03</div>
                            <div class="room-info">
                                <span class="room-status" id="room-status-ROOM03">è¼‰å…¥ä¸­...</span>
                                <span class="room-players" id="room-players-ROOM03">âš« - / âšª -</span>
                            </div>
                            <button class="pill-btn room-join-btn" id="room-join-ROOM03"
                                onclick="joinFixedRoom('ROOM03')">åŠ å…¥</button>
                        </div>
                    </div>

                    <button class="pill-btn secondary" style="margin-top:20px;" onclick="backToLanding()">è¿”å›é¸å–®</button>
                </div>

                <!-- Online Room View (Board + Details) -->
                <div id="online-room" class="hidden">
                    <div class="room-header-card">
                        <div class="room-status">
                            <span class="label">æˆ¿é–“ï¼š</span><span id="current-room-id" class="value">??????</span>
                            <span class="divider">|</span>
                            <span class="label">èº«ä»½ï¼š</span><span id="my-role" class="value">è¼‰å…¥ä¸­...</span>
                        </div>
                    </div>

                    <!-- Ready Status UI (Hidden until both players join) -->
                    <div id="ready-status" class="hidden"
                        style="margin:15px 0; padding:15px; background:rgba(0,255,136,0.1); border:1px solid rgba(0,255,136,0.3); border-radius:8px;">
                        <div class="ready-info"
                            style="display:flex; justify-content:space-around; margin-bottom:10px; font-size:0.9rem;">
                            <span id="black-ready-status">âš« é»‘ï¼šæœªæº–å‚™</span>
                            <span id="white-ready-status">âšª ç™½ï¼šæœªæº–å‚™</span>
                        </div>
                        <button id="toggle-ready-btn" class="pill-btn" onclick="toggleReady()"
                            style="width:100%;">æº–å‚™</button>
                    </div>

                    <!-- Game Over Actions (Rematch + Reset) -->
                    <div id="game-over-actions" class="hidden" style="margin:15px 0; display:flex; gap:10px;">
                        <button class="pill-btn" onclick="rematchGame()" style="flex:1;">ğŸ”„ å†æˆ°ä¸€å±€</button>
                        <button class="pill-btn danger-btn" onclick="resetFixedRoom()" style="flex:1;">ğŸ—‘ï¸ é‡ç½®æˆ¿é–“</button>
                    </div>

                    <div id="waiting-msg" style="margin-bottom:10px; color:var(--neon-green);">ç­‰å¾…å°æ‰‹åŠ å…¥...</div>

                    <div class="room-actions" style="margin-top:10px;">
                        <button id="leave-room-btn" class="pill-btn danger-btn" onclick="exitFixedRoom()">é€€å‡ºæˆ¿é–“</button>
                    </div>
                </div>

                <!-- Common Game Elements (Board, Status) -->
                <div id="game-board-area" class="hidden">
                    <div id="board-wrap">
                        <div class="board-frame">
                            <canvas id="gomoku-board"></canvas>
                        </div>
                        <div id="boardLock" aria-hidden="true" title="Board Locked"></div>
                    </div>

                    <div id="status-bar"
                        style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
                        <div id="status">ç•¶å‰å›åˆï¼š<span class="player-turn">é»‘å­</span></div>

                        <!-- Online Controls (Timer + Pause) -->
                        <div id="online-controls" class="hidden online-controls-flex">
                            <span id="game-timer" class="timer-display">30</span>
                            <button id="pause-btn" class="pill-btn secondary"
                                style="font-size:0.8rem; padding:5px 10px;" onclick="togglePause()">æš«åœ</button>
                        </div>
                    </div>

                    <!-- Only for AI mode, Online has its own restart logic -->
                    <button id="reset-btn" class="pill-btn action-btn" onclick="resetGame()">é‡æ–°é–‹å§‹</button>
                </div>

            </div>
        </main>
    </div>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/core.js?v=6429cf9"></script>
    <script src="js/renderer.js?v=6429cf9"></script>
    <script src="js/ai.js?v=6429cf9"></script>
    <script src="js/online.js?v=6429cf9"></script>
    <script src="js/input.js?v=6429cf9"></script>
    <script src="js/app.js?v=6429cf9"></script>

    <!-- Debug Panel (Added via Agent) -->
    <div id="debug-toggle" style="position:fixed; bottom:10px; right:10px; z-index:9999;">
        <button class="pill-btn secondary" onclick="toggleDebug()"
            style="font-size:0.8rem; padding:5px 10px;">Debug</button>
    </div>
    <div id="debug-panel" class="hidden"
        style="position:fixed; bottom:50px; right:10px; z-index:9999; background:rgba(0,0,0,0.9); padding:15px; border:1px solid red; color:lime; font-family:monospace; font-size:12px; max-width:90vw; border-radius:8px;">
        <div><strong>Supabase Debug</strong></div>
        <div>URL: <span id="dbg-url"></span></div>
        <div>Key Prefix: <span id="dbg-key-pre"></span></div>
        <div>Key Length: <span id="dbg-key-len"></span></div>
        <div>Key Tail (JSON): <span id="dbg-key-tail"></span></div>
        <div>Window.Supabase: <span id="dbg-win-sup"></span></div>
        <div>Client Init: <span id="dbg-client"></span></div>
        <hr style="border-color:#333; margin:5px 0;">
        <button class="pill-btn" onclick="pingSupabase()" style="font-size:0.7rem; padding:3px 8px;">Ping REST</button>
        <div id="dbg-ping-log" style="margin-top:5px; white-space:pre-wrap; word-break:break-all;"></div>
    </div>
    <script>
        function toggleDebug() {
            const p = document.getElementById('debug-panel');
            p.classList.toggle('hidden');
        }
    </script>
</body>

</html>